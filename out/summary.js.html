<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: summary.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: summary.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let shownGreeting = loadShownGreeting();

/**
 * Initializes the summary page by checking security, handling greeting overlay,
 * and loading summary data and user initials
 */
async function init() {
  checkLoggedInPageSecurity();
  const overlay = document.getElementById("greeting_overlay");
  if (window.innerWidth &lt;= 780 &amp;&amp; !loadShownGreeting()) {
    overlay.style.display = "flex";
    overlay.style.opacity = "1";
  } else {
    overlay.style.display = "none";
  }
  await initSummary();
  await eachPageSetCurrentUserInitials();
}

/**
 * Checks if an entry is a valid task object
 * @param {*} entry - The entry to validate
 * @returns {boolean} True if entry is a valid task object with a board property
 */
function isTaskEntry(entry) {
  return entry &amp;&amp; typeof entry === "object" &amp;&amp; entry.board;
}

/**
 * Extracts valid task objects from user data
 * @param {Object} userData - The user data containing tasks
 * @returns {Array} Array of valid task objects
 */
function extractTasks(userData) {
  let tasks = [];
  if (userData &amp;&amp; userData.tasks &amp;&amp; typeof userData.tasks === "object") {
    for (let taskId in userData.tasks) {
      let task = userData.tasks[taskId];
      if (isTaskEntry(task)) tasks.push(task);
    }
  }
  return tasks;
}

/**
 * Normalizes board values by converting to lowercase and removing spaces/underscores
 * @param {string} boardValue - The board value to normalize
 * @returns {string} Normalized board value
 */
function normalizeBoardValue(boardValue) {
  return String(boardValue || "").toLowerCase().replace(/\s|_/g, "");
}

/**
 * Formats a date object to a readable string format
 * @param {Date} deadlineDate - The date to format
 * @returns {string} Formatted date string or '-' if no date provided
 */
function formatDate(deadlineDate) {
  if (!deadlineDate) return "-";
  return deadlineDate.toLocaleDateString("en-US", { month: "long", day: "2-digit", year: "numeric" });
}

/**
 * Finds the next upcoming deadline from urgent tasks
 * @param {Array} tasks - Array of task objects
 * @returns {Date|null} The next deadline date or null if none found
 */
function findNextDeadline(tasks) {
  let today = new Date();
  today.setHours(0, 0, 0, 0);
  let urgentTasks = tasks.filter(t =>
    String(t.priority || "").toLowerCase() === "urgent"
  );
  if (urgentTasks.length === 0) return null;
  let deadlines = [];
  for (let task of urgentTasks) {
    if (!task.dueDate) continue;
    let due = new Date(task.dueDate);
    if (isNaN(due)) continue;
    due.setHours(0, 0, 0, 0);
    if (due >= today) deadlines.push(due);
  }
  return deadlines.length ? new Date(Math.min(...deadlines)) : null;
}

/**
 * Counts tasks by category and calculates next deadline
 * @param {Array} tasks - Array of task objects
 * @returns {Object} Object containing task counts and next deadline
 */
function countTasks(tasks) {
  let counts = { todo: 0, inProgress: 0, awaitingFeedback: 0, done: 0, urgent: 0, total: tasks.length, nextDeadline: "-" };
  for (let i = 0; i &lt; tasks.length; i++) {
    let board = normalizeBoardValue(tasks[i].board);
    let priority = String(tasks[i].priority || "").toLowerCase();

    if (board.includes("todo")) counts.todo++;
    else if (board.includes("inprogress")) counts.inProgress++;
    else if (board.includes("await")) counts.awaitingFeedback++;
    else if (board.includes("done")) counts.done++;

    if (priority === "urgent") counts.urgent++;
  }
  counts.nextDeadline = formatDate(findNextDeadline(tasks));
  return counts;
}

/**
 * Renders task counts to the DOM elements
 * @param {Object} taskCounts - Object containing task counts and deadline
 */
function renderSummaryCounts(taskCounts) {
  let numberFields = document.getElementsByClassName("numbers");

  if (numberFields[0]) numberFields[0].innerText = taskCounts.todo;
  if (numberFields[1]) numberFields[1].innerText = taskCounts.done;
  if (numberFields[2]) numberFields[2].innerText = taskCounts.urgent;
  if (numberFields[3]) numberFields[3].innerText = taskCounts.total;
  if (numberFields[4]) numberFields[4].innerText = taskCounts.inProgress;
  if (numberFields[5]) numberFields[5].innerText = taskCounts.awaitingFeedback;

  let deadlineField = document.getElementsByClassName("urgend_calender")[0];
  if (deadlineField) deadlineField.innerText = taskCounts.nextDeadline;
}

/**
 * Returns appropriate greeting text based on time of day
 * @param {Date} currentDate - The current date (optional, defaults to new Date())
 * @returns {string} Time-appropriate greeting text
 */
function getGreetingText(currentDate) {
  let hour = (currentDate || new Date()).getHours();
  if (hour &lt; 12) return "Good morning,";
  if (hour &lt; 18) return "Good afternoon,";
  return "Good evening,";
}

/**
 * Renders personalized greeting message to DOM
 * @param {string} userName - The user's name
 * @param {Date} currentDate - The current date for time-based greeting
 */
function renderGreeting(userName, currentDate) {
  const greetingText = document.getElementById("greeting_text");
  const greetingName = document.getElementById("greeting_name");
  if (!greetingText || !greetingName) return;
  const baseGreeting = getGreetingText(currentDate);
  if (!userName || userName.toLowerCase() === "guest user") {
    greetingText.innerText = baseGreeting.replace(",", "!");
    greetingName.style.display = "none";
  } else {
    greetingText.innerText = baseGreeting;
    greetingName.style.display = "block";
    greetingName.innerText = userName;
  }
}

/**
 * Initializes the summary dashboard by fetching user data,
 * processing tasks, and rendering summary information
 */
async function initSummary() {
  try {
    let userData = await fetchData(`/${activeUserId}`);
    if (!userData) return;
    let tasks = extractTasks(userData);
    let taskCounts = countTasks(tasks);
    renderSummaryCounts(taskCounts);
    renderGreeting(userData.name || "Guest User", new Date());
    shownGreeting = loadShownGreeting();
    document.getElementById("greeting_overlay").style.display = "none";
    if (window.innerWidth &lt;= 780 &amp;&amp; !shownGreeting) {
      showGreetingOverlay(userData.name || "Guest User");
    }
  } catch (error) {
    console.error("Summary could not be opened:", error);
  }
}

/**
 * Shows personalized greeting overlay on mobile devices with fade animation
 * @param {string} userName - The user's name for personalized greeting
 */
function showGreetingOverlay(userName) {
  if (window.innerWidth > 780 || shownGreeting) return;
  const overlay = document.getElementById("greeting_overlay");
  const text = document.getElementById("overlay_greeting_text");
  const name = document.getElementById("overlay_greeting_name");
  if (!overlay || !text || !name) {
    console.error("Overlay elements not found");
    return;
  }
  overlay.style.display = "flex";
  overlay.classList.remove("fade-out");
  const greeting = getGreetingText(new Date());
  if (!userName || userName.toLowerCase() === "guest user") {
    text.innerText = greeting.replace(",", "!");
    name.style.display = "none";
  } else {
    text.innerText = greeting;
    name.innerText = userName;
    name.style.display = "block";
  }
  setTimeout(() => overlay.classList.add("fade-out"), 1200);
  setTimeout(() => {
    overlay.style.display = "none";
    overlay.classList.remove("fade-out");
  }, 2000);
  shownGreeting = true;
  localStorage.setItem("shownGreeting", "true");
}

/**
 * Handles window resize events for the greeting overlay
 * Hides overlay on desktop view (> 780px width)
 */
function handleResizeOverlay() {
  const overlay = document.getElementById("greeting_overlay");
  if (window.innerWidth > 780 &amp;&amp; overlay) {
    overlay.style.display = "none";
    overlay.classList.remove("fade-out");
  }
}

/**
 * Keyboard event handler for summary page links
 * @param {KeyboardEvent} event - The keyboard event
 * @param {string} url - The URL to navigate to
 */
function handleSummaryLinkKeydown(event, url) {
    if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        window.location.href = url;
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addUser">addUser</a></li><li><a href="global.html#animateLogoFirstVisit">animateLogoFirstVisit</a></li><li><a href="global.html#calcNextId">calcNextId</a></li><li><a href="global.html#categoryColor">categoryColor</a></li><li><a href="global.html#changePasswordIcon">changePasswordIcon</a></li><li><a href="global.html#checkAllCreateContactValidations">checkAllCreateContactValidations</a></li><li><a href="global.html#checkAllValidations">checkAllValidations</a></li><li><a href="global.html#checkContactForPhone">checkContactForPhone</a></li><li><a href="global.html#checkContactForPhoneHtml">checkContactForPhoneHtml</a></li><li><a href="global.html#checkForAndDisplaySubtasks">checkForAndDisplaySubtasks</a></li><li><a href="global.html#checkForAndDisplayUserCircles">checkForAndDisplayUserCircles</a></li><li><a href="global.html#checkIconPathAndSetNewIconAndInputType">checkIconPathAndSetNewIconAndInputType</a></li><li><a href="global.html#checkIfElementIsNotDropdownOrDisplayElement">checkIfElementIsNotDropdownOrDisplayElement</a></li><li><a href="global.html#checkLoggedInPageSecurity">checkLoggedInPageSecurity</a></li><li><a href="global.html#checkTaskAssignedAgainstNullOrInvalidContacts">checkTaskAssignedAgainstNullOrInvalidContacts</a></li><li><a href="global.html#clearAllContactsInputFields">clearAllContactsInputFields</a></li><li><a href="global.html#clearAllSignUpInputFields">clearAllSignUpInputFields</a></li><li><a href="global.html#clickOutsideEventListener">clickOutsideEventListener</a></li><li><a href="global.html#closeAddTaskOverlay">closeAddTaskOverlay</a></li><li><a href="global.html#closeContactOverlay">closeContactOverlay</a></li><li><a href="global.html#closeDropDownAndResetFocus">closeDropDownAndResetFocus</a></li><li><a href="global.html#contactCancel">contactCancel</a></li><li><a href="global.html#contactsLargeSlideIn">contactsLargeSlideIn</a></li><li><a href="global.html#countTasks">countTasks</a></li><li><a href="global.html#createContact">createContact</a></li><li><a href="global.html#createInitialCircle">createInitialCircle</a></li><li><a href="global.html#createNextIdPutDataAndRender">createNextIdPutDataAndRender</a></li><li><a href="global.html#deletePath">deletePath</a></li><li><a href="global.html#deleteTaskfromBoard">deleteTaskfromBoard</a></li><li><a href="global.html#dragendHandler">dragendHandler</a></li><li><a href="global.html#dragoverHandler">dragoverHandler</a></li><li><a href="global.html#dragstartHandler">dragstartHandler</a></li><li><a href="global.html#eachPageSetCurrentUserInitials">eachPageSetCurrentUserInitials</a></li><li><a href="global.html#extractTasks">extractTasks</a></li><li><a href="global.html#fetchAndAddIdAndRemoveUndefinedContacts">fetchAndAddIdAndRemoveUndefinedContacts</a></li><li><a href="global.html#fetchAndSortContacts">fetchAndSortContacts</a></li><li><a href="global.html#fetchData">fetchData</a></li><li><a href="global.html#findNextDeadline">findNextDeadline</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#getGreetingText">getGreetingText</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#groupContactsByLetter">groupContactsByLetter</a></li><li><a href="global.html#guestLogin">guestLogin</a></li><li><a href="global.html#handleAutoScroll">handleAutoScroll</a></li><li><a href="global.html#handleCloseKeydown">handleCloseKeydown</a></li><li><a href="global.html#handleContactBackKeydown">handleContactBackKeydown</a></li><li><a href="global.html#handleContactCancelKeydown">handleContactCancelKeydown</a></li><li><a href="global.html#handleContactCloseKeydown">handleContactCloseKeydown</a></li><li><a href="global.html#handleContactDeleteKeydown">handleContactDeleteKeydown</a></li><li><a href="global.html#handleContactEditKeydown">handleContactEditKeydown</a></li><li><a href="global.html#handleContactKeydown">handleContactKeydown</a></li><li><a href="global.html#handleContactSubmitKeydown">handleContactSubmitKeydown</a></li><li><a href="global.html#handleDeleteTaskKeydown">handleDeleteTaskKeydown</a></li><li><a href="global.html#handleEditDropdown">handleEditDropdown</a></li><li><a href="global.html#handleEditTaskKeydown">handleEditTaskKeydown</a></li><li><a href="global.html#handleGlobalResize">handleGlobalResize</a></li><li><a href="global.html#handleMenuEscapeKey">handleMenuEscapeKey</a></li><li><a href="global.html#handleMobileDeleteKeydown">handleMobileDeleteKeydown</a></li><li><a href="global.html#handleMobileEditKeydown">handleMobileEditKeydown</a></li><li><a href="global.html#handleMobileMenuKeydown">handleMobileMenuKeydown</a></li><li><a href="global.html#handlePasswordToggleKeydown">handlePasswordToggleKeydown</a></li><li><a href="global.html#handleResizeOverlay">handleResizeOverlay</a></li><li><a href="global.html#handleSearchButtonKeydown">handleSearchButtonKeydown</a></li><li><a href="global.html#handleSearchKeydown">handleSearchKeydown</a></li><li><a href="global.html#handleSubtaskToggleKeydown">handleSubtaskToggleKeydown</a></li><li><a href="global.html#handleSummaryLinkKeydown">handleSummaryLinkKeydown</a></li><li><a href="global.html#handleTaskCardKeydown">handleTaskCardKeydown</a></li><li><a href="global.html#handleUserMenuKeydown">handleUserMenuKeydown</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initSummary">initSummary</a></li><li><a href="global.html#isCheckboxValid">isCheckboxValid</a></li><li><a href="global.html#isConfirmValid">isConfirmValid</a></li><li><a href="global.html#isEmailValid">isEmailValid</a></li><li><a href="global.html#isNameValid">isNameValid</a></li><li><a href="global.html#isPassValid">isPassValid</a></li><li><a href="global.html#isPhoneValid">isPhoneValid</a></li><li><a href="global.html#isTaskEntry">isTaskEntry</a></li><li><a href="global.html#loadActiveUserId">loadActiveUserId</a></li><li><a href="global.html#loadAndRenderContacts">loadAndRenderContacts</a></li><li><a href="global.html#loadShownGreeting">loadShownGreeting</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#moveTo">moveTo</a></li><li><a href="global.html#normalizeBoardValue">normalizeBoardValue</a></li><li><a href="global.html#openDeleteContact">openDeleteContact</a></li><li><a href="global.html#openDropDownResetFocusAndAddListener">openDropDownResetFocusAndAddListener</a></li><li><a href="global.html#openEditContact">openEditContact</a></li><li><a href="global.html#passwordVisible">passwordVisible</a></li><li><a href="global.html#positionSearchField">positionSearchField</a></li><li><a href="global.html#putData">putData</a></li><li><a href="global.html#renderAddTaskOverlay">renderAddTaskOverlay</a></li><li><a href="global.html#renderContactLarge">renderContactLarge</a></li><li><a href="global.html#renderContacts">renderContacts</a></li><li><a href="global.html#renderContactsInOverlay">renderContactsInOverlay</a></li><li><a href="global.html#renderEditTaskDetail">renderEditTaskDetail</a></li><li><a href="global.html#renderGreeting">renderGreeting</a></li><li><a href="global.html#renderGroupedContacts">renderGroupedContacts</a></li><li><a href="global.html#renderSubtasksForOverlay">renderSubtasksForOverlay</a></li><li><a href="global.html#renderSummaryCounts">renderSummaryCounts</a></li><li><a href="global.html#renderTaskDetail">renderTaskDetail</a></li><li><a href="global.html#renderTasks">renderTasks</a></li><li><a href="global.html#saveToLocalStorage">saveToLocalStorage</a></li><li><a href="global.html#searchAndClearSearchField">searchAndClearSearchField</a></li><li><a href="global.html#searchFieldPositionInclusiveWcagAriaConformityA">searchFieldPositionInclusiveWcagAriaConformityA</a></li><li><a href="global.html#searchFieldPositionInclusiveWcagAriaConformityB">searchFieldPositionInclusiveWcagAriaConformityB</a></li><li><a href="global.html#searchTasks">searchTasks</a></li><li><a href="global.html#setContactDataForBackendUpload">setContactDataForBackendUpload</a></li><li><a href="global.html#setDataForBackendUpload">setDataForBackendUpload</a></li><li><a href="global.html#showDialogContact">showDialogContact</a></li><li><a href="global.html#showDialogCreateContact">showDialogCreateContact</a></li><li><a href="global.html#showGreetingOverlay">showGreetingOverlay</a></li><li><a href="global.html#showPopup">showPopup</a></li><li><a href="global.html#slideInOverlay">slideInOverlay</a></li><li><a href="global.html#startAutoScroll">startAutoScroll</a></li><li><a href="global.html#stopAutoScroll">stopAutoScroll</a></li><li><a href="global.html#toggleDropDownMenu">toggleDropDownMenu</a></li><li><a href="global.html#toggleMobileContactMenu">toggleMobileContactMenu</a></li><li><a href="global.html#toggleStyle">toggleStyle</a></li><li><a href="global.html#toggleSubtask">toggleSubtask</a></li><li><a href="global.html#updateContact">updateContact</a></li><li><a href="global.html#validateCheckboxSeperately">validateCheckboxSeperately</a></li><li><a href="global.html#validateField">validateField</a></li><li><a href="global.html#validateFieldContact">validateFieldContact</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Dec 01 2025 22:34:39 GMT+0100 (Mitteleurop√§ische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
